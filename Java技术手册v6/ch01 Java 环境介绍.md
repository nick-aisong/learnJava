#### 第 1 章 Java 环境介绍

欢迎学习 Java 8。也许应该说欢迎你回来。你可能是从其他语言转到这个生态系统的，也可能这是你学习的第一门编程语言。不管你是如何到达这里的，都要欢迎你。很高兴你选择了 Java。

Java 是一个强大且通用的编程环境，是世界上使用范围最广的编程语言之一，在商务和企业计算领域取得了极大的成功。

本章介绍 Java 语言（供程序员编写应用）、Java 虚拟机（用来运行应用）和 Java 生态系统（为开发团队提供很多有价值的编程环境）。

我们会先简要介绍 Java 语言和虚拟机的历史，然后说明 Java 程序的生命周期，最后厘清 Java 和其他环境之间一些常见的疑问。

本章最后会介绍 Java 的安全性，还会讨论一些安全编程相关的话题。

##### 1.1 Java 语言、JVM 和生态系统

Java 编程环境出现于 20 世纪 90 年代末，由 Java 语言和运行时组成。运行时也叫 Java 虚拟机（Java Virtual Machine，JVM）。

Java 刚出现时，这种分离方式很新奇，但最近软件开发的趋势表明，这已经变成了通用做法。值得一提的是微软的 .NET 环境，它比 Java 晚几年出现，但沿用了非常类似的平台架构方式。

微软的 .NET 平台和 Java 相比有个重要的区别，人们都觉得 Java 是相对开放的生态系统，有多个开发方。在 Java 的演进过程中，这些开发方在合作的同时也有竞争，不断推进 Java 的技术发展。

Java 成功的主要原因之一是，整个生态系统是个标准的环境。这意味着组成 Java 环境的各种技术都有规范。这些标准让开发者和客户相信，自己所用的技术能和其他组件兼容，即便来自不同的技术提供方也不怕。

Java 目前归甲骨文公司所有（甲骨文收购了发明 Java 的太阳计算机系统公司，以下简称 Sun）。红帽、IBM、惠普、SAP、苹果和富士通等公司也大量参与了 Java 标准技术的实现。

Java 也有开源版本，叫 OpenJDK，由多家公司合作开发。

其实，Java 由多个不同但相互联系的环境和规范组成，包括 Java 移动版（Java ME）、Java 标准版（Java SE）和 Java 企业版（Java EE）。本书只涵盖 Java SE 第 8 版。

后面会详细说明标准，现在先介绍 Java 语言和 JVM。这是两个不同但互有关联的概念。

###### 1.1.1 Java 语言是什么

Java 程序的源码使用 Java 语言编写。Java 是人类可读的编程语言，基于类，而且面向对象，比较易读易写（偶尔有点啰嗦）。

Java 有意识地降低了教、学成本，参考了 C++ 等语言的行业经验，尽量删除了复杂的功能，但保留了“前辈”编程语言的精粹。

总的来说，Java 的目的是为企业开发商业应用提供坚实稳定的基础。

作为一门编程语言，Java 的设计相对保守，而且改动频率低。这么做是有意保护企业对 Java 技术的投入。

Java 语言自 1996 年发布之后，一直在不断地修订（但没有完全重写）。也就是说，一开始为 Java 选择的设计方式，即 20 世纪 90 年代末采用的那些权宜之计，现在仍旧影响着这门语言。详情参见第 2 章和第 3 章。

Java 8 的变动幅度很大，是近十年来罕见的（有些人觉得是 Java 出现以来最大的变动）。lambda 表达式的引入和核心中集合 API 的大幅度改写等，将彻底改变大多数 Java 开发者编写代码的方式。

Java 语言受 Java 语言规范（Java Language Specification，JLS）的约束，这个规范限定了某项功能必须采用某种方式实现。

###### 1.1.2 JVM 是什么

JVM 是一个程序，提供了运行 Java 程序所需的运行时环境。如果某个硬件和操作系统平台没有相应的 JVM，就不能运行 Java 程序。

幸好，JVM 被移植到了大多数设备中，机顶盒、蓝光播放器、大型机或许都有适用的 JVM。

Java 程序一般都在命令行中启动，例如：
```java
java <arguments> <program name>
```

这个命令会在操作系统的一个进程中启动 JVM，提供 Java 运行时环境，然后在刚启动的（空）虚拟机中运行指定的程序。

有一点很重要，你要知道：提供给 JVM 运行的程序不是 Java 语言源码，源码必须转换（或编译）成一种称为 Java 字节码的格式。提供给 JVM 的 Java 字节码必须是类文件格式，其扩展名为 .class。

JVM 是字节码格式程序的解释器，一次只执行字节码中的一个指令。而且，你还要知道，JVM 和用户提供的程序都能派生额外的线程，所以用户提供的程序中可能同时运行着多个不同的函数。

JVM 的设计方式建立在几个早期编程环境的多年发展经验之上，尤其是 C 和 C++，因此有多个目的，这些目的都是为了减轻程序员的负担。

- 包含一个容器，让应用代码在其中运行。
- 较之 C/C++，提供了一个安全的执行环境。
- 代开发者管理内存。
- 提供一个跨平台的执行环境。

介绍 JVM 时往往都会提到这些目的。

前面介绍 JVM 和字节码解释器时已经提到了第一个目的，即 JVM 是应用代码的容器。

第 6 章介绍 Java 环境如何管理内存时会讨论第二个和第三个目的。

第四个目的有时也说成“一次编写，到处运行”，意思是 Java 类文件可从一个运行平台迁移到另一个平台，只要有可用的 JVM，就能正常运行。

也就是说，Java 程序可以在运行着 OS X 的苹果 Mac 电脑中开发（并转换成类文件），然后把类文件移到 Linux 或微软 Windows（或其他平台）中，无需任何改动，Java 程序依然能运行。


###### 1.1.3 Java 生态系统是什么








##### 1.2 Java 和 JVM 简史








##### 1.3 Java 程序的生命周期








##### 1.4 Java 的安全性








##### 1.5 Java 和其他语言比较









###### 1.5.1 Java 和 C 语言比较









###### 1.5.2 Java 和 C++ 比较









###### 1.5.3 Java 和 PHP 比较











###### 1.5.4 Java 和 JavaScript 比较











##### 1.6 回应对 Java 的一些批评

Java 出现在公共视线中已有很长一段时间了，因此，在这些年里受到的批评也相当多。这些批评可以归咎于一些技术缺点，以及第一版过度的市场推广。

不过，有些批评只是技术圈的传言，不是很准确。本节，我们来看一些常见的抱怨，以及它们在最新版 Java 平台中的状况。

###### 1.6.1 过度复杂

人们经常批评 Java 核心语言过度复杂。即便是 Object o = new Object(); 这样简单的语句，也有重复——赋值符号左右两边都出现了类型 Object。批评人士认为这么做完全是多余的，其他语言都不需要重复声明类型，而且很多辅助功能都不用这么做（例如类型推导）。

这样的说法我不认同。从一开始， Java 的设计目标就是易于阅读（读代码的次数比写代码多很多）， 许多程序员，尤其是新手，都觉得额外的类型信息有助于阅读代码。

Java 广泛用于企业环境，开发团队往往和运维团队不同。这些额外的信息一般会在处理停机，或者需要维护和修订早就投身其他事务的开发者编写的代码时提供重大帮助。

在最近几个 Java 版本中（ 7 和后面的版本），语言的设计者已经在尝试回应这些观点，他们寻找可以简化句法复杂度的地方，也更充分地利用类型信息。例如：
```java
// 文件辅助方法
byte[] contents = Files.readAllBytes(Paths.get("/home/ben/myFile.bin"));
// 使用菱形句法表示重复的类型信息
List<String> l = new ArrayList<>();
// lambda表达式，简化了Runnable
ExecutorService threadPool = Executors.newScheduledThreadPool(2);
threadPool.submit(() -> { System.out.println("On Threadpool"); });
```
然而， Java 的总体原则是非常缓慢且谨慎地修改语言，所以这些变化可能无法完全让批评者满意。

###### 1.6.2 变化慢

Java 第一版发布至今已经超过 15 年了，而且在那个时候也没经过完整修订。在这段时间
里，很多其他语言（例如微软的 C#）都发布了不向后兼容的版本，而 Java 没这么做，因
此受到了部分开发者的批评。

而且，最近几年， Java 语言因为没有及时吸收其他语言中常见的功能而受到严厉批评。

Sun（现在是甲骨文）在语言设计上采取了保守方式，是为了尽量避免把成本和不合理功能的外部效应强加在大量的用户群体身上。很多使用 Java 的公司都为这一技术注入了重资，语言设计者要认真负责，不能影响现有的用户和安装群体。

每一个新语言功能都要审慎考虑，不只是新功能本身，还要考虑它会如何影响语言现有的功能。有时，新功能的影响会超过目及之处，而 Java 的使用范围又如此广泛，因此可能有很多地方会产生意料之外的影响。

功能发布后，如果有问题，几乎无法将其删除。 Java 有一些不合理的功能（例如终结机制），在不影响安装群体的情况下，根本无法安全地删除。语言设计者认为，在语言演进的过程中必须极为小心。

话虽如此，但 Java 8 引入的新语言功能向前迈出了一大步，回应了最常见的功能缺失抱怨，应该能为开发者提供他们一直诉求的语言特性。

###### 1.6.3 性能问题

现在仍然有人批评 Java 平台的速度慢，而且所有批评都集中在“平台”上，这或许是最不合理的批评了。

Java 1.3 引入了 HotSpot 虚拟机和 JIT 编译器，而且在随后的 15 年里，一直在革新和改进虚拟机及其性能。现在， Java 平台的速度异常快，经常会在流行的框架性能评测中取胜，甚至打败了编译成本地机器码的 C 和 C++。

针对这方面的批评大都是因为陈旧的记忆，因为以前的某段时间 Java 很慢。 Java 使用的大型且不规则延展的架构方式可能也加深了人们对性能低下的印象。

然而，事实上，任何大型架构都需要评测、分析和性能调校，才能得到最好的表现， Java也不例外。

Java 平台的核心（ Java 语言和 JVM）不仅现在是，以后也仍将是开发者可用的速度最快的通用环境。

###### 1.6.4 不安全

2013 年， Java 平台出现了几个安全漏洞，导致 Java 8 的发布日期延后了。其实，在此之前就有人批评 Java 的安全漏洞数量众多。

在这些漏洞中，有很多都涉及 Java 系统的桌面和 GUI 组件，不会影响使用 Java 编写的网站或其他服务器端代码。

所有编程平台都会时不时地出现安全问题，而且很多其他语言的安全漏洞不比 Java 少，只是少有人知罢了。

###### 1.6.5 太注重企业

Java 平台在公司和企业的开发者中使用广泛，因此觉得 Java 太注重企业一点也不奇怪。人们认为 Java 缺少面向社区的语言所具有的自由风格。

其实， Java 一直都是，而且以后仍将是社区和免费或开源软件开发所广泛使用的语言。在 GitHub 和其他项目托管网站中， Java 是最受欢迎的。

而且，使用范围最广的 Java 语言是通过 OpenJDK 实现的。而 OpenJDK 本身就是开源项目，其社区充满活力，一直在不断增长。

