测试并发应用程序
========

- 监控Lock接口
- 监控Phaser类
- 监控执行器框架
- 监控Fork/Join池
- 输出高效的日志信息
- 使用FindBugs分析并发代码
- 配置Eclipse调试并发代码
- 配置NetBeans调试并发代码
- 使用MultithreadedTC测试并发代码

### 1 简介
对应用程序进行测试是一个关键的任务。
在将应用程序交付给最终客户使用前，必须检验应用程序的正确性。
我们使用测试流程来证明应用程序的正确性。
测试是软件开发的基本环节，也称为质量保证(Quality Assurance)过程，
可以找到大量文章介绍关于测试过程的不同方法，这些方法可用于应用程序开发当中

也有大量的类包(如单元测试框架JUnit)以及应用程序(如Apache JMetter)它们可用来以一种自动化方式测试Java应用，
在并发应用程序开发中进行测试则显得更加关键。
并发应用程序实际_上是多个线程共享数据结构并相互交互，这在很大程度上增加了测试的难度。
在测试并发应用程序时，要面对的最大的问题是线程的执行是不确定的(Non-Deterministic)，
我们无法保证线程执行的顺序，所以很难重现错误

在本章，我们将学习下列内容：
- 如何获取并发应用程序中元素的信息，这些信息有助于测试应用程序
- 如何使用IDE(Integrated Development Environment)和其他工具(如FindBugs)来测试应用程序
- 如何使用类库(如MultithreadedTC)来进行自动化测试

### 2 监控Lock接口
Lock接口是Java并发API同步代码块的基本机制之一。
它定义了临界区(Critical Section)。
临界区是同一时间只能被一个线程执行的共享资源的代码块。
这种机制是通过Lock接口和ReentrantLock类而实现的

### 3 监控Phaser类
Java并发API提供的最复杂最强大的功能之一是使用Phaser类执行并发阶段任务(Concurrent Phased Task)。
当有并发任务被分为几步时这一机制非常有用。
Phaser类提供了在每步结束时同步等待其他线程的机制，
因此，只有所有线程都执行完各自的第一步操作之后，才会开始执行接下来的第二步操作

### 4 监控执行器框架
执行器框架(Executor Framework)提供了一套机制把任务的实现和创建与管理执行这些任务的线程分开。
如果使用一个执行器(Executor)，必须实现Runnable对象并将其发送到执行器。
执行器负责管理线程，当有任务到达时，它将尝试使用线程池中的线程来执行这个任务，从而避免创建新的线程。
Executor接口和它的实现类ThreadPoolExecutor提供了这套机制

### 5 监控Fork/Join池
执行器框架(Executor Framework)提供了一套机制把任务的实现和创建与管理执行这些任务的线程分开。
Java 7引入了执行器框架的一个扩展，针对一些特定问题，
比其他解决方案(如直接使用Thread对象或Executor框架)具有更高的性能，
这就是Fork/Join框架(Fork/Join Framework)。
Fork/Join框架被设计用来解决能够被分解成更小任务的问题，
通过分治技术(Divide and Conquer Technique)，采用fork()和join()方法运行操作。
实现这种行为的主类是ForkJoinPool类

### 6 输出高效的日志信息
日志系统(Log System)是将信息输出到一个或多个目标上的一种机制

一个日志器(Logger)有下面几个组件
- 一个或多个处理器(Handler)：处理器决定目标和日志消息的格式。可把日志消息输出到控制台上、写到文件中或保存到数据库中
- 一个名称 (Name)：一般来说，类中的日志记录器的名称是基于它的包名和类名的
- 一个级别(Level)：日志消息有一个关联的级别来表示它的重要性。
日志记录器也有一个级别用来决定它要输出什么级别的消息。
日志记录器仅输出与它的级别相同重要或更重要的消息

使用日志系统有下面两个主要目的
- 当捕获到异常时尽可能多地输出信息，这有助于定位并解决错误
- 输出关于程序正在执行的类和方法的信息

### 7 使用FindBugs分析并发代码
静态代码分析工具(Static Code Analysis Tool)是一套通过分析应用程序的源代码来查出潜在错误的工具集。
这些工具，如Checkstyle、PMD或FindBugs，提供了预定义的最佳实践的规则集来分析源代码、查找源代码是否违反了这些规则。
这些工具的目标是，在应用程序正式投产前发现错误或定位性能瓶颈之处。
编程语言通常提供了这类工具，Java语言也不例外。
分析Java代码的工具之一是FindBugs。
它是一个开源工具，包含了一系列规则来分析Java并发代码

### 8 配置Eclipse调试并发代码
无论使用什么编程语言，如今几乎每个程序员都使用IDE集成开发环境来创建应用程序

IDE提供了大量已集成的有趣的功能，如
- 项目管理
- 代码自动生成
- 文档自动生成
- 集成版本控制系统
- 测试应用程序的调试器
- 创建项目或应用元素的各种向导

IDE中最有帮助的特性之一就是调试器，它可以一步步地执行应用程序并分析程序中的对象和变量的值。
如果使用Java编程语言，Eclipse是最流行的IDE之一。它有一个集成的调试器，用来测试应用程序。
缺省时，当你调试一个并发应用程序并且发现一个断点，调试器仅停止有断点的线程而其他线程继续执行

### 9 配置NetBeans调试并发代码
如今，开发应用程序时，选用相应的软件工具是非常必要的。
应用程序需要满足公司的质量标准，未来易于修改且费用低耗时少。
为了实现这个目标，使用同一界面下集成了多个工具(编译器和调试器)来促进应用程序开发的IDE极为重要。
如果使用Java编程语言，NetBeans也是最流行的IDE之一。 
它有一个集成的调试器，用来测试应用程序

### 10 使用MultithreadedTC测试并发代码
MultithreadedTC是一个测试并发应用程序的Java类库，它的主要目标是解决不确定的并发应用程序存在的问题。
而我们无法控制线程的执行顺序。
为了这个目标，MultithreadedTC用一个内部节拍器(metronome)来控制应用程序不同线程的执行顺序。
这些测试线程被实现为类的方法

