创建类模式大PK
========

创建类模式包括
1. 工厂方法模式
2. 建造者模式
3. 抽象工厂模式
4. 单例模式
5. 原型模式

它们都能够提供对象的创建和管理职责。其中的单例模式和原型模式非常容易理解，单例模式
是要保持在内存中只有一个对象，原型模式是要求通过复制的方式产生一个新的对象，这两
个不容易混淆。剩下的就是工厂方法模式、抽象工厂模式和建造者模式了，这三个之间有较
多的相似性

#### 工厂方法模式VS建造者模式

按工厂方法建造超人

详见：factoryMethod

工厂方法模式注重的是整体对象的创建方法，而建造者模式注重的是部件构建的过程，
旨在通过一步一步地精确构造创建出一个复杂的对象

我们举个简单例子来说明两者的差异，如要制造一个超人，如果使用工厂方法模式，直接产生出来的就是一个力大无穷、能够
飞翔、内裤外穿的超人；而如果使用建造者模式，则需要组装手、头、脚、躯干等部分，然
后再把内裤外穿，于是一个超人就诞生了。纯粹使用文字来描述比较枯燥，我们还是通过程
序来更加清晰地认识两者的差别

建立了一个超人生产工厂，年复一年地生产超人，对于具体生产出的产品，不管是成年
超人还是未成年超人，都是一个模样：深蓝色紧身衣、胸前S标记、内裤外穿，没有特殊的
地方。但是我们的目的达到了——生产出超人，拯救全人类，这就是我们的意图。具体怎么
生产、怎么组装，这不是工厂方法模式要考虑的，也就是说，工厂模式关注的是一个产品整
体，生产出的产品应该具有相似的功能和架构

注意：通过工厂方法模式生产出对象，然后由客户端进行对象的其他操作，但是并不代
表所有生产出的对象都必须具有相同的状态和行为，它是由产品所决定

按建造者模式建造超人

详见：builder

又是一个典型的建造者模式！哎，不对呀！通用模式上抽象建造者与产品类没有关系
呀！是的，我们当然可以加强了，我们在抽象建造者上使用了模板方法模式，每一个建造者
都必须返回一个产品，但是产品是如何制造的，则由各个建造者自己负责

最佳实践

工厂方法模式和建造者模式都属于对象创建类模式，都用来创建类的对象。但它们之间
的区别还是比较明显的

意图不同

在工厂方法模式里，我们关注的是一个产品整体，如超人整体，无须关心产品的各部分
是如何创建出来的；但在建造者模式中，一个具体产品的产生是依赖各个部件的产生以及装
配顺序，它关注的是“由零件一步一步地组装出产品对象”。简单地说，工厂模式是一个对象
创建的粗线条应用，建造者模式则是通过细线条勾勒出一个复杂对象，关注的是产品组成部
分的创建过程

意图不同

工厂方法模式创建的产品一般都是单一性质产品，如成年超人，都是一个模样，而建造
者模式创建的则是一个复合产品，它由各个部件复合而成，部件不同产品对象当然不同。这
不是说工厂方法模式创建的对象简单，而是指它们的粒度大小不同。一般来说，工厂方法模
式的对象粒度比较粗，建造者模式的产品对象粒度比较细

工厂方法模式创建的产品一般都是单一性质产品，如成年超人，都是一个模样，而建造
者模式创建的则是一个复合产品，它由各个部件复合而成，部件不同产品对象当然不同。这
不是说工厂方法模式创建的对象简单，而是指它们的粒度大小不同。一般来说，工厂方法模
式的对象粒度比较粗，建造者模式的产品对象粒度比较细

两者的区别有了，那在具体的应用中，我们该如何选择呢？是用工厂方法模式来创建对
象，还是用建造者模式来创建对象，这完全取决于我们在做系统设计时的意图，如果需要详
细关注一个产品部件的生产、安装步骤，则选择建造者，否则选择工厂方法模式

#### 抽象工厂模式VS建造者模式

抽象工厂模式实现对产品家族的创建，一个产品家族是这样的一系列产品：具有不同分
类维度的产品组合，采用抽象工厂模式则是不需要关心构建过程，只关心什么产品由什么工
厂生产即可。而建造者模式则是要求按照指定的蓝图建造产品，它的主要目的是通过组装零
配件而产生一个新产品，两者的区别还是比较明显的，但是还有读者对这两个模式产生混
淆，我们通过一个例子说明两者的差别

现代化的汽车工厂能够批量生产汽车（不考虑手工打造的豪华车）。不同的工厂生产不
同的汽车，宝马工厂生产宝马牌子的车，奔驰工厂生产奔驰牌子的车。车不仅具有不同品
牌，还有不同的用途分类，如商务车Van，运动型车SUV等，我们按照两种设计模式分别实
现车辆的生产过程

按抽象工厂模式生产车辆

按照抽象工厂模式，首先需要定义一个抽象的产品接口即汽车接口，然后宝马和奔驰分
别实现该接口，由于它们只具有了一个品牌属性，还没有定义一个具体的型号，属于对象的
抽象层次，每个具体车型由其子类实现，如R系列的奔驰车是商务车，X系列的宝马车属于
SUV

详见：abstractFactory

在类图中，产品类很简单，我们从两个维度看产品：品牌和车型，每个品牌下都有两个
车型，如宝马SUV，宝马商务车等，同时我们又建造了两个工厂，一个专门生产宝马车的宝
马工厂BMWFactory，一个是生产奔驰车的奔驰车生产工厂BenzFactory。当然，汽车工厂也
有两个不同的维度，可以建立这样两个工厂：一个专门生产SUV车辆的生产工厂，生产宝马
SUV和奔驰SUV，另外一个工厂专门生成商务车，分别是宝马商务车和奔驰商务车，这样设
计在技术上是完全可行的，但是在业务上是不可行的，为什么？这是因为你看到过有一个工
厂既能生产奔驰SUV也能生产宝马SUV吗？这是不可能的，因为业务受限，除非是国内的山
寨工厂

对外界调用者来说，只要更换一个具备相同结构的对象，即可发生非常大的改变，如我
们原本使用BenzFactory生产汽车，但是过了一段时间后，我们的系统需要生产宝马汽车，这
对系统来说不需要很大的改动，只要把工厂类使用BMWFactory代替即可，立刻可以生产出
宝马车，注意这里生产的是一辆完整的车，对于一个产品，只要给出产品代码（车类型）即
可生产，抽象工厂模式把一辆车认为是一个完整的、不可拆分的对象。它注重完整性，一个
产品一旦找到一个工厂生产，那就是固定的型号，不会出现一个宝马工厂生产奔驰车的情
况。那现在的问题是我们就想要一辆混合的车型，如奔驰的引擎，宝马的车轮，那该怎么处
理呢？使用我们的建造者模式！

按建造者模式生产车辆

详见：builder

按照建造者模式设计一个生产车辆需要把车辆进行拆分，拆分成引擎和车轮两部分，然
后由建造者进行建造，想要什么车，你只要有设计图纸就成，马上可以制造一辆车出来。它
注重的是对零件的装配、组合、封装，它从一个细微构件装配角度看待一个对象

注意最后一个运行结果片段，我们可以立刻生产出一辆混合车型，只要有设计蓝图，这
非常容易实现。反观我们的抽象工厂模式，它是不可能实现该功能的，因为它更关注的是整
体，而不关注到底用的是奔驰引擎还是宝马引擎，而我们的建造者模式却可以很容易地实现
该设计，市场信息变更了，我们就可以立刻跟进，生产出客户需要的产品

最佳实践

注意看上面的描述，我们在抽象工厂模式中使用“工厂”来描述构建者，而在建造者模式
中使用“车间”来描述构建者，其实我们已经在说它们两者的区别了，抽象工厂模式就好比是
一个一个的工厂，宝马车工厂生产宝马SUV和宝马VAN，奔驰车工厂生产奔驰车SUV和奔驰
VAN，它是从一个更高层次去看对象的构建，具体到工厂内部还有很多的车间，如制造引擎
的车间、装配引擎的车间等，但这些都是隐藏在工厂内部的细节，对外不公布。也就是对领
导者来说，他只要关心一个工厂到底是生产什么产品的，不用关心具体怎么生产。而建造者
模式就不同了，它是由车间组成，不同的车间完成不同的创建和装配任务，一个完整的汽车
生产过程需要引擎制造车间、引擎装配车间的配合才能完成，它们配合的基础就是设计蓝
图，而这个蓝图是掌握在车间主任（导演类）手中，它给建造车间什么蓝图就能生产什么产
品，建造者模式更关心建造过程。虽然从外界看来一个车间还是生产车辆，但是这个车间的
转型是非常快的，只要重新设计一个蓝图，即可产生不同的产品，这有赖于建造者模式的功
劳

相对来说，抽象工厂模式比建造者模式的尺度要大，它关注产品整体，而建造者模式关
注构建过程，因此建造者模式可以很容易地构建出一个崭新的产品，只要导演类能够提供具
体的工艺流程。也正因为如此，两者的应用场景截然不同，如果希望屏蔽对象的创建过程，
只提供一个封装良好的对象，则可以选择抽象工厂方法模式。而建造者模式可以用在构件的
装配方面，如通过装配不同的组件或者相同组件的不同顺序，可以产生出一个新的对象，它
可以产生一个非常灵活的架构，方便地扩展和维护系统
