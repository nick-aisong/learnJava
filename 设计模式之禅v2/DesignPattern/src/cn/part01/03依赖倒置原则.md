依赖倒置原则
========

依赖倒置原则的定义：  

依赖倒置原则（Dependence Inversion Principle,DIP）这个名字看着有点别扭，“依
赖”还“倒置”，这到底是什么意思？依赖倒置原则的原始定义是：

High level modules should not depend upon low level modules.Both should depend upon
abstractions. Abstractions should not depend upon details.Details should depend upon abstractions.

翻译过来，包含三层含义：
- 高层模块不应该依赖低层模块，两者都应该依赖其抽象
- 抽象不应该依赖细节
- 细节应该依赖抽象

高层模块和低层模块容易理解，每一个逻辑的实现都是由原子逻辑组成的，不可分割的
原子逻辑就是低层模块，原子逻辑的再组装就是高层模块。那什么是抽象？什么又是细节
呢？在Java语言中，抽象就是指接口或抽象类，两者都是不能直接被实例化的；细节就是实
现类，实现接口或继承抽象类而产生的类就是细节，其特点就是可以直接被实例化，也就是
可以加上一个关键字new产生一个对象

依赖倒置原则在Java语言中的表现就是：
- 模块间的依赖通过抽象发生，实现类之间不发生直接的依赖关系，其依赖关系是通过
接口或抽象类产生的
- 接口或抽象类不依赖于实现类
- 实现类依赖接口或抽象类

更加精简的定义就是“面向接口编程”——OOD（Object-Oriented Design，面向对象设
计）的精髓之一

采用依赖倒置原则可以减少类间的耦合性，提高系统的稳定性，降低并行开发引起的风
险，提高代码的可读性和可维护性

注意：设计是否具备稳定性，只要适当地“松松土”，观察“设计的蓝图”是否还可以茁壮
地成长就可以得出结论，稳定性较高的设计，在周围环境频繁变化的时候，依然可以做
到“我自岿然不动”

注意：在Java中，只要定义变量就必然要有类型，一个变量可以有两种类型：表面类型
和实际类型，表面类型是在定义的时候赋予的类型，实际类型是对象的类型

两个类之间有依赖关系，只要制定出两者之
间的接口（或抽象类）就可以独立开发了，而且项目之间的单元测试也可以独立地运行，而
TDD（Test-Driven Development，测试驱动开发）开发模式就是依赖倒置原则的最高级应
用

抽象是对实现的约束，对依赖者而言，也是一种契约，不仅仅约束自己，还同时约束自
己与外部的关系，其目的是保证所有的细节不脱离契约的范畴，确保约束双方按照既定的契
约（抽象）共同发展，只要抽象这根基线在，细节就脱离不了这个圈圈，始终让你的对象做
到“言必信，行必果”

依赖是可以传递的，A对象依赖B对象，B又依赖C，C又依赖D……生生不息，依赖不
止，记住一点：只要做到抽象依赖，即使是多层的依赖传递也无所畏惧！

对象的依赖关系有三种方式来传递，如下所示：
1. 构造函数传递依赖对象
2. Setter方法传递依赖对象
3. 接口声明依赖对象

依赖倒置原则的本质就是通过抽象（接口或抽象类）使各个类或模块的实现彼此独立，
不互相影响，实现模块间的松耦合，我们怎么在项目中使用这个规则呢？只要遵循以下的几
个规则就可以：
- 每个类尽量都有接口或抽象类，或者抽象类和接口两者都具备
- 变量的表面类型尽量是接口或者是抽象类
- 任何类都不应该从具体类派生（负责项目维护的同志，基本上可以不考虑这个规则）
- 尽量不要覆写基类的方法
- 结合里氏替换原则使用（接口负责定义public属性和方法，并且声明与其他
对象的依赖关系，抽象类负责公共构造部分的实现，实现类准确的实现业务逻辑，同时在适
当的时候对父类进行细化）

那到底什么是“倒置”呢？
我们先说“正置”是什么意思，依赖正置就是类间的依赖是实实在在的实现类间的依赖，也就是面
向实现编程，这也是正常人的思维方式，我要开奔驰车就依赖奔驰车，我要使用笔记本电脑
就直接依赖笔记本电脑，而编写程序需要的是对现实世界的事物进行抽象，抽象的结果就是
有了抽象类和接口，然后我们根据系统设计的需要产生了抽象间的依赖，代替了人们传统思
维中的事物间的依赖，“倒置”就是从这里产生的

依赖倒置原则的优点在小型项目中很难体现出来，例如小于10个人月的项目，使用简单
的SSH架构，基本上不费太大力气就可以完成，是否采用依赖倒置原则影响不大。但是，在
一个大中型项目中，采用依赖倒置原则有非常多的优点，特别是规避一些非技术因素引起的
问题。项目越大，需求变化的概率也越大，通过采用依赖倒置原则设计的接口或抽象类对实
现类进行约束，可以减少需求变化引起的工作量剧增的情况。人员的变动在大中型项目中也
是时常存在的，如果设计优良、代码结构清晰，人员变化对项目的影响基本为零。大中型项
目的维护周期一般都很长，采用依赖倒置原则可以让维护人员轻松地扩展和维护

依赖倒置原则是6个设计原则中最难以实现的原则，它是实现开闭原则的重要途径，依
赖倒置原则没有实现，就别想实现对扩展开放，对修改关闭。在项目中，大家只要记住
是“面向接口编程”就基本上抓住了依赖倒置原则的核心





